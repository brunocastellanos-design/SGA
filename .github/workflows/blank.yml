name: Ejecutar Script y Subir Excel Automático 🚀

on:
  # 1. EJECUCIÓN AUTOMÁTICA DIARIA: 00:00 UTC (medianoche)
  # El cron "0 0 * * *" significa: Minuto 0, Hora 0, Día del mes (*, cualquiera), Mes (*, cualquiera), Día de la semana (*, cualquiera)
  schedule:
    - cron: '0 0 * * *' 
  
  # 2. Permite la ejecución manual o por API (para Power Automate)
  workflow_dispatch: 

jobs:
  run_script:
    runs-on: ubuntu-latest
    
    steps:
      - uses: actions/checkout@v3

      - name: Configurar Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'

      - name: Instalar dependencias
        run: |
          python -m pip install --upgrade pip
          pip install pandas xlrd openpyxl unidecode 

      - name: Ejecutar script Python y Generar Excel
        # Si el archivo datos_generados.xlsx ya existe, este paso lo sobrescribirá.
        run: python HISTORICO.py 

      # PASO DE VERIFICACIÓN: Muestra el contenido de la carpeta de trabajo
      # Esto ayuda a confirmar que el archivo datos_generados.xlsx existe antes de subirlo.
      - name: Listar archivos para verificar
        run: ls -l
        
      - name: Subir Excel como Artefacto
        uses: actions/upload-artifact@v4
        with:
          name: ExcelGeneradoPorScript 
          path: datos_generados.xlsx
          # IMPORTANTE: Ya que se trata de una nueva ejecución, GitHub siempre sobrescribe 
          # el Artefacto con el mismo nombre si existe.
          retention-days: 1
